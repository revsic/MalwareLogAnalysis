import argparse

import numpy as np

from .model import MalwareDetector
from .train import load_csv

if __name__ == '__main__':
    parser = argparse.ArgumentParser()
    parser.add_argument('--seqlen', type=int, default=100)
    parser.add_argument('--embedding_size', type=int, default=1054)
    parser.add_argument('--ckpt_dir', default='./ckpt')
    parser.add_argument('--sample', default='./data/testset.csv')
    args = parser.parse_args()

    model = MalwareDetector(args.seqlen, args.embedding_size)
    model.restore(args.ckpt_dir)

    label, data = load_csv(args.sample, args.seqlen)
    label_str = ', '.join(str(l) for l in label)

    predicted = model.inference(data).reshape(-1)
    predicted_str = ', '.join(str(p) for p in predicted)

    accuracy = np.mean((label == predicted).astype(np.float32))

    print('accuracy: {:.3f}'.format(accuracy * 100))
    print('predicted: [{}]'.format(predicted_str))
    print('real outp: [{}]'.format(label_str))
